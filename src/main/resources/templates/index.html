<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Word Cloud</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Impact" rel="stylesheet">
    <style>
        svg {
            width: 80%;
            height: 80%;
            margin: auto;
            display: block;
        }
    </style>
</head>
<body>
<div th:replace="fragment/header :: header"></div>
<div id="wordcloud"></div>
<script th:inline="javascript">
        var width = window.innerWidth * 0.8, height = window.innerHeight * 0.8;
        var hotWords = /*[[${hotWords}]]*/ null;
        var data = [];
        var colors = ["#1f77b4", "#aec7e8", "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d", "#17becf", "#9edae5"];

        var colorScale = d3.scaleOrdinal()
            .range(colors);
        if (hotWords) {
            data = hotWords.map(function(hotWord) {
                return {text: hotWord._id, size: hotWord.weight * 1000, doc: hotWord.doc};
            });
        }
        console.log(hotWords);
        var layout = d3.layout.cloud()
            .size([width, height])
            .words(data)
            .padding(5)
<!--            .rotate(function() { return ~~(Math.random() * 2) * 90; })-->
            .rotate(() => 0)
            .font("Impact")
            .fontSize(function(d) { return d.size; })
            .on("end", draw);
        layout.start();

        function draw(words) {
            console.log(words);
            d3.select("#wordcloud").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
                .selectAll("text")
                .data(words)
                .enter().append("text")
                  .attr("id", function(d) { return d.text; }) // set the id property to the text value
                  .style("font-size", function(d) { return d.size + "px"; })
                  .style("font-family", "Impact")
                  .style("fill", function(d, i) { return colorScale(i); })
                  .attr("text-anchor", "middle")
                  .attr("transform", function(d) {
                      return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                  })
                  .text(function(d) { return d.text; })
                  .on("click", function(event, d) {
                    if (d.doc) {
                        window.location.href = "/docs?word=" + d.text;
                    }
                });
        }
    </script>
</body>
</html>